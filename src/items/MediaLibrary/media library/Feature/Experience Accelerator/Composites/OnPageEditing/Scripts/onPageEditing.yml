---
ID: "10fc34f1-3206-4bc0-8ce4-716f616e0449"
Parent: "4efe74c8-53fb-4a08-a60b-d093b5333239"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Feature/Experience Accelerator/Composites/OnPageEditing/Scripts/onPageEditing
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/10FC34F132064BC08CE4716F616E0449.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "10fc34f1-3206-4bc0-8ce4-716f616e0449"
  Value: dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgew0KICAgIHZhciBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8DQogICAgICAgICh7DQogICAgICAgICAgICAgICAgX19wcm90b19fOiBbXQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgew0KICAgICAgICAgICAgICAgIGQuX19wcm90b19fID0gYjsNCiAgICAgICAgICAgIH0pIHx8DQogICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7DQogICAgICAgICAgICBmb3IgKHZhciBwIGluIGIpDQogICAgICAgICAgICAgICAgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOw0KICAgICAgICB9Ow0KICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgew0KICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOw0KDQogICAgICAgIGZ1bmN0aW9uIF9fKCkgew0KICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7DQogICAgICAgIH0NCiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOw0KICAgIH07DQp9KSgpOw0KdmFyIFNYQTsNCihmdW5jdGlvbiAoU1hBKSB7DQogICAgdmFyIENvbW1vbjsNCiAgICAoZnVuY3Rpb24gKENvbW1vbikgew0KICAgICAgICB2YXIgUHJveHlPcmRlcjsNCiAgICAgICAgKGZ1bmN0aW9uIChQcm94eU9yZGVyKSB7DQogICAgICAgICAgICBQcm94eU9yZGVyW1Byb3h5T3JkZXJbIkJlZm9yZSJdID0gMF0gPSAiQmVmb3JlIjsNCiAgICAgICAgICAgIFByb3h5T3JkZXJbUHJveHlPcmRlclsiQWZ0ZXIiXSA9IDFdID0gIkFmdGVyIjsNCiAgICAgICAgfSkoUHJveHlPcmRlciA9IENvbW1vbi5Qcm94eU9yZGVyIHx8IChDb21tb24uUHJveHlPcmRlciA9IHt9KSk7DQogICAgICAgIHZhciBIdG1sSGVscGVycyA9IChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBmdW5jdGlvbiBIdG1sSGVscGVycygpIHt9DQogICAgICAgICAgICBIdG1sSGVscGVycy5hZGRQcm94eSA9IGZ1bmN0aW9uIChvcGVyYW5kLCBmdW5jdGlvbk5hbWUsIHByb3h5Rm4sIG9yZGVyKSB7DQogICAgICAgICAgICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsNCiAgICAgICAgICAgICAgICAgICAgb3JkZXIgPSBQcm94eU9yZGVyLkJlZm9yZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcGVyYW5kID09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9yZGVyID09PSBQcm94eU9yZGVyLkJlZm9yZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkUHJveHlCZWZvcmVUb0Z1bmN0aW9uKG9wZXJhbmQsIGZ1bmN0aW9uTmFtZSwgcHJveHlGbik7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRQcm94eUFmdGVyVG9GdW5jdGlvbihvcGVyYW5kLCBmdW5jdGlvbk5hbWUsIHByb3h5Rm4pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9yZGVyID09PSBQcm94eU9yZGVyLkJlZm9yZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkUHJveHlCZWZvcmVUb09iamVjdChvcGVyYW5kLCBmdW5jdGlvbk5hbWUsIHByb3h5Rm4pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkUHJveHlBZnRlclRvT2JqZWN0KG9wZXJhbmQsIGZ1bmN0aW9uTmFtZSwgcHJveHlGbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgSHRtbEhlbHBlcnMucGFyc2VRdWVyeSA9IGZ1bmN0aW9uIChxdWVyeVN0cmluZykgew0KICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHt9Ow0KICAgICAgICAgICAgICAgIHZhciBhID0gKHF1ZXJ5U3RyaW5nWzBdID09PSAiPyIgPyBxdWVyeVN0cmluZy5zdWJzdHIoMSkgOiBxdWVyeVN0cmluZykuc3BsaXQoIiYiKTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhW2ldLnNwbGl0KCI9Iik7DQogICAgICAgICAgICAgICAgICAgIHF1ZXJ5W2RlY29kZVVSSUNvbXBvbmVudChiWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQoYlsxXSB8fCAiIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBIdG1sSGVscGVycy50b1F1ZXJ5ID0gZnVuY3Rpb24gKHF1ZXJ5U3RyaW5nT2JqZWN0KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHF1ZXJ5U3RyaW5nT2JqZWN0KS5tYXAoZnVuY3Rpb24gKGtleSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5ICsgJz0nICsgcXVlcnlTdHJpbmdPYmplY3Rba2V5XTsNCiAgICAgICAgICAgICAgICB9KS5qb2luKCcmJyk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgSHRtbEhlbHBlcnMuYWRkUHJveHlCZWZvcmVUb0Z1bmN0aW9uID0gZnVuY3Rpb24gKGZuLCBmdW5jdGlvbk5hbWUsIHByb3h5Rm4pIHsNCiAgICAgICAgICAgICAgICB2YXIgcHJveGllZCA9IGZuLnByb3RvdHlwZVtmdW5jdGlvbk5hbWVdOw0KICAgICAgICAgICAgICAgIGZuLnByb3RvdHlwZVtmdW5jdGlvbk5hbWVdID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlGbihhcmd1bWVudHMpOw0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgSHRtbEhlbHBlcnMubG9nRXJyb3IoZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBwcm94aWVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBIdG1sSGVscGVycy5hZGRQcm94eUJlZm9yZVRvT2JqZWN0ID0gZnVuY3Rpb24gKG9iaiwgZnVuY3Rpb25OYW1lLCBwcm94eUZuKSB7DQogICAgICAgICAgICAgICAgdmFyIHByb3hpZWQgPSBvYmpbZnVuY3Rpb25OYW1lXTsNCiAgICAgICAgICAgICAgICBvYmpbZnVuY3Rpb25OYW1lXSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5Rm4oYXJndW1lbnRzKTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEh0bWxIZWxwZXJzLmxvZ0Vycm9yKGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcHJveGllZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgSHRtbEhlbHBlcnMuYWRkUHJveHlBZnRlclRvRnVuY3Rpb24gPSBmdW5jdGlvbiAoZm4sIGZ1bmN0aW9uTmFtZSwgcHJveHlGbikgew0KICAgICAgICAgICAgICAgIHZhciBwcm94aWVkID0gZm4ucHJvdG90eXBlW2Z1bmN0aW9uTmFtZV07DQogICAgICAgICAgICAgICAgZm4ucHJvdG90eXBlW2Z1bmN0aW9uTmFtZV0gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBwcm94aWVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eUZuKGFyZ3VtZW50cyk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ0Vycm9yKGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgSHRtbEhlbHBlcnMuYWRkUHJveHlBZnRlclRvT2JqZWN0ID0gZnVuY3Rpb24gKG9iaiwgZnVuY3Rpb25OYW1lLCBwcm94eUZuKSB7DQogICAgICAgICAgICAgICAgdmFyIHByb3hpZWQgPSBvYmpbZnVuY3Rpb25OYW1lXTsNCiAgICAgICAgICAgICAgICBvYmpbZnVuY3Rpb25OYW1lXSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHByb3hpZWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5Rm4oYXJndW1lbnRzKTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nRXJyb3IoZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBIdG1sSGVscGVycy5sb2dFcnJvciA9IGZ1bmN0aW9uIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbU1hBXSBBbiBlcnJvciBvY2N1cnJlZCBpbiB0aGUgcHJveHkgZnVuY3Rpb24uIik7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJldHVybiBIdG1sSGVscGVyczsNCiAgICAgICAgfSgpKTsNCiAgICAgICAgQ29tbW9uLkh0bWxIZWxwZXJzID0gSHRtbEhlbHBlcnM7DQogICAgfSkoQ29tbW9uID0gU1hBLkNvbW1vbiB8fCAoU1hBLkNvbW1vbiA9IHt9KSk7DQp9KShTWEEgfHwgKFNYQSA9IHt9KSk7DQooZnVuY3Rpb24gKFNYQSkgew0KICAgIHZhciBGZWF0dXJlOw0KICAgIChmdW5jdGlvbiAoRmVhdHVyZSkgew0KICAgICAgICB2YXIgQ29tcG9zaXRlczsNCiAgICAgICAgKGZ1bmN0aW9uIChDb21wb3NpdGVzKSB7DQogICAgICAgICAgICB2YXIgUmVuZGVyaW5nID0gKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBSZW5kZXJpbmcocmF3UmVuZGVyaW5nKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucmF3UmVuZGVyaW5nID0gcmF3UmVuZGVyaW5nOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gcmF3UmVuZGVyaW5nWyJAcGgiXTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy51bmlxdWVJZCA9IHJhd1JlbmRlcmluZ1siQHVpZCJdOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtZXRlcnMgPSBTWEEuQ29tbW9uLkh0bWxIZWxwZXJzLnBhcnNlUXVlcnkocmF3UmVuZGVyaW5nWyJAcGFyIl0pOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWNQbGFjZWhvbGRlcklkID0gdGhpcy5wYXJhbWV0ZXJzWyJEeW5hbWljUGxhY2Vob2xkZXJJZCJdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBSZW5kZXJpbmcucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRyb2xJZCA9IHRoaXMudW5pcXVlSWQucmVwbGFjZSgvWy17fV0vZywgIiIpOw0KICAgICAgICAgICAgICAgICAgICBTaXRlY29yZS5MYXlvdXREZWZpbml0aW9uLnJlbW92ZShjb250cm9sSWQpOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgUmVuZGVyaW5nLnByb3RvdHlwZS5tYXJrQXNNb2RpZmllZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGlmaWVkRmxhZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB2YXIgbGF5b3V0RGVmaW5pdGlvbiA9IFNpdGVjb3JlLkxheW91dERlZmluaXRpb24uZ2V0TGF5b3V0RGVmaW5pdGlvbigpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudERldmljZSA9IFNpdGVjb3JlLkxheW91dERlZmluaXRpb24uZ2V0RGV2aWNlKGxheW91dERlZmluaXRpb24pOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnREZXZpY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhciBhbGxEZXZpY2VzID0gbGF5b3V0RGVmaW5pdGlvbi5yLmQ7DQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgYWxsRGV2aWNlcy5sZW5ndGg7IG0rKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbERldmljZXNbbV1bIkBpZCJdID09IGN1cnJlbnREZXZpY2VbIkBpZCJdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBhbGxEZXZpY2VzW21dLnIubGVuZ3RoOyBuKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbERldmljZXNbbV0ucltuXVsiQHVpZCJdID09IHRoaXMudW5pcXVlSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJpbmdQYXJhbWV0ZXJzID0gYWxsRGV2aWNlc1ttXS5yW25dWyJAcGFyIl07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVyc09iamVjdCA9IFNYQS5Db21tb24uSHRtbEhlbHBlcnMucGFyc2VRdWVyeShyZW5kZXJpbmdQYXJhbWV0ZXJzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNPYmplY3RbIm9uUGFnZUVkaXRpbmdPZkNvbXBvc2l0ZXNTdGF0ZSJdID0gdGhpcy51bmlxdWVJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbERldmljZXNbbV0ucltuXVsiQHBhciJdID0gU1hBLkNvbW1vbi5IdG1sSGVscGVycy50b1F1ZXJ5KHBhcmFtZXRlcnNPYmplY3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRGbGFnID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChtb2RpZmllZEZsYWcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNpdGVjb3JlLkxheW91dERlZmluaXRpb24uc2V0TGF5b3V0RGVmaW5pdGlvbihsYXlvdXREZWZpbml0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlbmRlcmluZzsNCiAgICAgICAgICAgIH0oKSk7DQogICAgICAgICAgICBDb21wb3NpdGVzLlJlbmRlcmluZyA9IFJlbmRlcmluZzsNCiAgICAgICAgICAgIHZhciBDb250ZXh0ID0gKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBDb250ZXh0KCkge30NCiAgICAgICAgICAgICAgICBDb250ZXh0Lm9uUGFnZUVkaXRpbmdFbmFibGVkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFNpdGVjb3JlLlBhZ2VNb2Rlcy5QYWdlRWRpdG9yLm9uUGFnZUVkaXRpbmdPZkNvbXBvc2l0ZXMgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNpdGVjb3JlLlBhZ2VNb2Rlcy5QYWdlRWRpdG9yLm9uUGFnZUVkaXRpbmdPZkNvbXBvc2l0ZXMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoX2EpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgcmV0dXJuIENvbnRleHQ7DQogICAgICAgICAgICB9KCkpOw0KICAgICAgICAgICAgQ29tcG9zaXRlcy5Db250ZXh0ID0gQ29udGV4dDsNCiAgICAgICAgICAgIHZhciBPblBhZ2VFZGl0aW5nU2VydmljZSA9IChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgZnVuY3Rpb24gT25QYWdlRWRpdGluZ1NlcnZpY2UoKSB7fQ0KICAgICAgICAgICAgICAgIE9uUGFnZUVkaXRpbmdTZXJ2aWNlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOw0KICAgICAgICAgICAgICAgICAgICB2YXIgb3JpZ2luYWxSZW5kZXJpbmcgPSBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lVHlwZXMuUmVuZGVyaW5nLnByb3RvdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgU1hBLkNvbW1vbi5IdG1sSGVscGVycy5hZGRQcm94eShvcmlnaW5hbFJlbmRlcmluZywgImRlbGV0ZUNvbnRyb2wiLCBmdW5jdGlvbiAoYXJncykgew0KICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub25SZW5kZXJpbmdSZW1vdmUoYXJncyk7DQogICAgICAgICAgICAgICAgICAgIH0sIFNYQS5Db21tb24uUHJveHlPcmRlci5CZWZvcmUpOw0KICAgICAgICAgICAgICAgICAgICBTWEEuQ29tbW9uLkh0bWxIZWxwZXJzLmFkZFByb3h5KG9yaWdpbmFsUmVuZGVyaW5nLCAiZGVsZXRlQ29udHJvbCIsIGZ1bmN0aW9uIChhcmdzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5vblJlbmRlcmluZ1JlbW92ZU1hcmtBc01vZGlmaWVkKGFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICB9LCBTWEEuQ29tbW9uLlByb3h5T3JkZXIuQmVmb3JlKTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIE9uUGFnZUVkaXRpbmdTZXJ2aWNlLnByb3RvdHlwZS5nZXRSZW1vdmVkUmVuZGVyaW5nID0gZnVuY3Rpb24gKGFyZ3MpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBhcmdzWzBdOw0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVtb3ZlZFJlbmRlcmluZ0lkID0gZGF0YS5fb3JpZ2luYWxET01FbGVtZW50LmNvbnRleHQuaWQucmVwbGFjZSgicl8iLCAiIik7DQogICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJpbmcgPSBuZXcgUmVuZGVyaW5nKFNpdGVjb3JlLkxheW91dERlZmluaXRpb24uZ2V0UmVuZGVyaW5nKHJlbW92ZWRSZW5kZXJpbmdJZCkpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyaW5nOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgT25QYWdlRWRpdGluZ1NlcnZpY2UucHJvdG90eXBlLmdldEFsbFJlbmRlcmluZ3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciByYXdSZW5kZXJpbmdzID0gU2l0ZWNvcmUuTGF5b3V0RGVmaW5pdGlvbi5nZXRSZW5kZXJpbmdzKCk7DQogICAgICAgICAgICAgICAgICAgIHZhciBhbGxSZW5kZXJpbmdzID0gJHhhLm1hcChyYXdSZW5kZXJpbmdzLCBmdW5jdGlvbiAocmF3KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlbmRlcmluZyhyYXcpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbFJlbmRlcmluZ3M7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBPblBhZ2VFZGl0aW5nU2VydmljZS5wcm90b3R5cGUub25SZW5kZXJpbmdSZW1vdmUgPSBmdW5jdGlvbiAoYXJncykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVuZGVyaW5nID0gdGhpcy5nZXRSZW1vdmVkUmVuZGVyaW5nKGFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgYWxsUmVuZGVyaW5ncyA9IHRoaXMuZ2V0QWxsUmVuZGVyaW5ncygpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgcGF0dGVybiA9ICIvIiArIHJlbmRlcmluZy5wbGFjZWhvbGRlciArICIvc2VjdGlvbi0oW3RpdGxlfGNvbnRlbnRdKSstXFxkKy0iICsgcmVuZGVyaW5nLmR5bmFtaWNQbGFjZWhvbGRlcklkOw0KCQkJCQlwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cL1wvL2csICcvJyk7DQogICAgICAgICAgICAgICAgICAgIHZhciBjb21wb3NpdGVSZW5kZXJpbmdzID0gJHhhLmdyZXAoYWxsUmVuZGVyaW5ncywgZnVuY3Rpb24gKHIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByLnBsYWNlaG9sZGVyLm1hdGNoKG5ldyBSZWdFeHAocGF0dGVybiwgImciKSkgIT0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICR4YS5lYWNoKGNvbXBvc2l0ZVJlbmRlcmluZ3MsIGZ1bmN0aW9uIChpbmRleCwgcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIucmVtb3ZlKCk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgT25QYWdlRWRpdGluZ1NlcnZpY2UucHJvdG90eXBlLm9uUmVuZGVyaW5nUmVtb3ZlTWFya0FzTW9kaWZpZWQgPSBmdW5jdGlvbiAoYXJncykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVuZGVyaW5nID0gdGhpcy5nZXRSZW1vdmVkUmVuZGVyaW5nKGFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgYWxsUmVuZGVyaW5ncyA9IHRoaXMuZ2V0QWxsUmVuZGVyaW5ncygpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXIgPSBuZXcgQ29tcG9zaXRlcy5QbGFjZWhvbGRlcihyZW5kZXJpbmcucGxhY2Vob2xkZXIpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgY29tcG9zaXRlU2VjdGlvblBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXIuR2V0Q29tcG9zaXRlU2VjdGlvblBsYWNlaG9sZGVyKCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChjb21wb3NpdGVTZWN0aW9uUGxhY2Vob2xkZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBvc2l0ZUR5bmFtaWNQbGFjZWhvbGRlcklEXzEgPSBjb21wb3NpdGVTZWN0aW9uUGxhY2Vob2xkZXIubWF0Y2goL3NlY3Rpb24tKFt0aXRsZXxjb250ZW50XSkrLVxkKy0oLiopLylbMl07DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcG9zaXRlUGxhY2Vob2xkZXJOYW1lXzEgPSBwbGFjZWhvbGRlci5HZXRDb21wb3NpdGVQbGFjZWhvbGRlck5hbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21wb3NpdGVSZW5kZXJpbmdzID0gJHhhLmdyZXAoYWxsUmVuZGVyaW5ncywgZnVuY3Rpb24gKHIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5wbGFjZWhvbGRlciA9PSBjb21wb3NpdGVQbGFjZWhvbGRlck5hbWVfMSAmJiByLmR5bmFtaWNQbGFjZWhvbGRlcklkID09IGNvbXBvc2l0ZUR5bmFtaWNQbGFjZWhvbGRlcklEXzE7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICR4YS5lYWNoKGNvbXBvc2l0ZVJlbmRlcmluZ3MsIGZ1bmN0aW9uIChpbmRleCwgcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByLm1hcmtBc01vZGlmaWVkKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgcmV0dXJuIE9uUGFnZUVkaXRpbmdTZXJ2aWNlOw0KICAgICAgICAgICAgfSgpKTsNCiAgICAgICAgICAgIENvbXBvc2l0ZXMuT25QYWdlRWRpdGluZ1NlcnZpY2UgPSBPblBhZ2VFZGl0aW5nU2VydmljZTsNCiAgICAgICAgICAgIHZhciBDb21wb3NpdGVzSW5pdEhhbmRsZXIgPSAoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENvbXBvc2l0ZXNJbml0SGFuZGxlcigpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb3NpdGVNb2R1bGVzTmFtZXMgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb3NpdGVNb2R1bGVzTmFtZXMucHVzaCgiY2Fyb3VzZWxzIik7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcG9zaXRlTW9kdWxlc05hbWVzLnB1c2goInRhYnMiKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb3NpdGVNb2R1bGVzTmFtZXMucHVzaCgiZmxpcCIpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvc2l0ZU1vZHVsZXNOYW1lcy5wdXNoKCJhY2NvcmRpb25zIik7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcG9zaXRlTW9kdWxlc05hbWVzLnB1c2goInNuaXBwZXQiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQ29tcG9zaXRlc0luaXRIYW5kbGVyLnByb3RvdHlwZS5wcm9jZXNzID0gZnVuY3Rpb24gKG5hbWUsIG1vZHVsZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb21wb3NpdGVNb2R1bGVzTmFtZXMuaW5kZXhPZihuYW1lKSA+IC0xKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcmZvcm1BY3Rpb24obmFtZSwgbW9kdWxlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgcmV0dXJuIENvbXBvc2l0ZXNJbml0SGFuZGxlcjsNCiAgICAgICAgICAgIH0oKSk7DQogICAgICAgICAgICBDb21wb3NpdGVzLkNvbXBvc2l0ZXNJbml0SGFuZGxlciA9IENvbXBvc2l0ZXNJbml0SGFuZGxlcjsNCiAgICAgICAgICAgIHZhciBDb21wb3NpdGVzUHJlSW5pdEhhbmRsZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgICAgICAgICAgICAgIF9fZXh0ZW5kcyhDb21wb3NpdGVzUHJlSW5pdEhhbmRsZXIsIF9zdXBlcik7DQoNCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBDb21wb3NpdGVzUHJlSW5pdEhhbmRsZXIoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQ29tcG9zaXRlc1ByZUluaXRIYW5kbGVyLnByb3RvdHlwZS5wZXJmb3JtQWN0aW9uID0gZnVuY3Rpb24gKG5hbWUsIG1vZHVsZSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgZGlzYWJsZWRQbGFjZWhvbGRlcnMgPSB3aW5kb3cudG9wLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5zY0VtcHR5UGxhY2Vob2xkZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGRpc2FibGVkUGxhY2Vob2xkZXJzLmxlbmd0aDsgaW5kZXgrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBoID0gZGlzYWJsZWRQbGFjZWhvbGRlcnNbaW5kZXhdOw0KICAgICAgICAgICAgICAgICAgICAgICAgcGguY2xhc3NMaXN0LnJlbW92ZSgic2NFbXB0eVBsYWNlaG9sZGVyIik7DQogICAgICAgICAgICAgICAgICAgICAgICBwaC5jbGFzc0xpc3QuYWRkKCJzY0VtcHR5UGxhY2Vob2xkZXJTeGEiKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgcmV0dXJuIENvbXBvc2l0ZXNQcmVJbml0SGFuZGxlcjsNCiAgICAgICAgICAgIH0oQ29tcG9zaXRlc0luaXRIYW5kbGVyKSk7DQogICAgICAgICAgICBDb21wb3NpdGVzLkNvbXBvc2l0ZXNQcmVJbml0SGFuZGxlciA9IENvbXBvc2l0ZXNQcmVJbml0SGFuZGxlcjsNCiAgICAgICAgICAgIHZhciBDb21wb3NpdGVzUG9zdEluaXRIYW5kbGVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHsNCiAgICAgICAgICAgICAgICBfX2V4dGVuZHMoQ29tcG9zaXRlc1Bvc3RJbml0SGFuZGxlciwgX3N1cGVyKTsNCg0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENvbXBvc2l0ZXNQb3N0SW5pdEhhbmRsZXIoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQ29tcG9zaXRlc1Bvc3RJbml0SGFuZGxlci5wcm90b3R5cGUucGVyZm9ybUFjdGlvbiA9IGZ1bmN0aW9uIChuYW1lLCBtb2R1bGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGRpc2FibGVkUGxhY2Vob2xkZXJzID0gd2luZG93LnRvcC5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuc2NFbXB0eVBsYWNlaG9sZGVyU3hhIik7DQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBkaXNhYmxlZFBsYWNlaG9sZGVycy5sZW5ndGg7IGluZGV4KyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaCA9IGRpc2FibGVkUGxhY2Vob2xkZXJzW2luZGV4XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBoLmNsYXNzTGlzdC5yZW1vdmUoInNjRW1wdHlQbGFjZWhvbGRlclN4YSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcGguY2xhc3NMaXN0LmFkZCgic2NFbXB0eVBsYWNlaG9sZGVyIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBDb21wb3NpdGVzUG9zdEluaXRIYW5kbGVyOw0KICAgICAgICAgICAgfShDb21wb3NpdGVzSW5pdEhhbmRsZXIpKTsNCiAgICAgICAgICAgIENvbXBvc2l0ZXMuQ29tcG9zaXRlc1Bvc3RJbml0SGFuZGxlciA9IENvbXBvc2l0ZXNQb3N0SW5pdEhhbmRsZXI7DQogICAgICAgIH0pKENvbXBvc2l0ZXMgPSBGZWF0dXJlLkNvbXBvc2l0ZXMgfHwgKEZlYXR1cmUuQ29tcG9zaXRlcyA9IHt9KSk7DQogICAgfSkoRmVhdHVyZSA9IFNYQS5GZWF0dXJlIHx8IChTWEEuRmVhdHVyZSA9IHt9KSk7DQp9KShTWEEgfHwgKFNYQSA9IHt9KSk7DQooZnVuY3Rpb24gKFNYQSkgew0KICAgIHZhciBGZWF0dXJlOw0KICAgIChmdW5jdGlvbiAoRmVhdHVyZSkgew0KICAgICAgICB2YXIgQ29tcG9zaXRlczsNCiAgICAgICAgKGZ1bmN0aW9uIChDb21wb3NpdGVzKSB7DQogICAgICAgICAgICBpZiAoQ29tcG9zaXRlcy5Db250ZXh0Lm9uUGFnZUVkaXRpbmdFbmFibGVkKCkpIHsNCiAgICAgICAgICAgICAgICB2YXIgc2VydmljZSA9IG5ldyBTWEEuRmVhdHVyZS5Db21wb3NpdGVzLk9uUGFnZUVkaXRpbmdTZXJ2aWNlKCk7DQogICAgICAgICAgICAgICAgc2VydmljZS5pbml0KCk7DQogICAgICAgICAgICAgICAgdmFyIHByZUhhbmRsZXIgPSBuZXcgU1hBLkZlYXR1cmUuQ29tcG9zaXRlcy5Db21wb3NpdGVzUHJlSW5pdEhhbmRsZXIoKTsNCiAgICAgICAgICAgICAgICB2YXIgcG9zdEhhbmRsZXIgPSBuZXcgU1hBLkZlYXR1cmUuQ29tcG9zaXRlcy5Db21wb3NpdGVzUG9zdEluaXRIYW5kbGVyKCk7DQogICAgICAgICAgICAgICAgWEEucmVnaXN0ZXJPblByZUluaXRIYW5kbGVyKHByZUhhbmRsZXIpOw0KICAgICAgICAgICAgICAgIFhBLnJlZ2lzdGVyT25Qb3N0SW5pdEhhbmRsZXIocG9zdEhhbmRsZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KShDb21wb3NpdGVzID0gRmVhdHVyZS5Db21wb3NpdGVzIHx8IChGZWF0dXJlLkNvbXBvc2l0ZXMgPSB7fSkpOw0KICAgIH0pKEZlYXR1cmUgPSBTWEEuRmVhdHVyZSB8fCAoU1hBLkZlYXR1cmUgPSB7fSkpOw0KfSkoU1hBIHx8IChTWEEgPSB7fSkpOw0K
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 15771
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "ba3f86a2-4a1c-4d78-b63d-91c2779c1b5e"
  Hint: __Sortorder
  Value: 0
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160509T120144Z
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "ddf34e91-3142-4bbd-baf8-7797af09caa5"
